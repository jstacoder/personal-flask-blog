from flask import Blueprint

from ..models.blog import Blog
from ..views.generic import SingleObjectView, ListObjectView

class GetBlogView(SingleObjectView):
    model = Blog
    object_context_name = 'blog'
    object_kwarg_name = 'blog_id'

    def get_json(self, obj):
        return {
            'title': obj.title,
            'slug': obj.slug,
            'author': obj.author.emails[0].email,
            'published_date': obj.published_date,
            'comments': [o.get_json(exclude=['blog']) for o in obj.comments]
        }

class ListBlogsView(ListObjectView):
    model = Blog
    object_context_name = 'blogs'


BlogBlueprint = Blueprint('blogs', __name__)

BlogBlueprint.add_url_rule('/<blog_id>/', view_func=GetBlogView.as_view('get_blog'))
BlogBlueprint.add_url_rule('/', view_func=ListBlogsView.as_view('list_blogs'))

